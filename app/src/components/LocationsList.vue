<template>
  <div>
    <div class="locationsList">
      <Location
        v-for="location in locations"
        :key="location.name"
        :location="location"
        :on-delete="handleDelete"
        :on-update="handleUpdate"
        :climbingStyles="climbingStyles"
      />
    </div>
    <div class="add-location">
      <LocationForm
        :climbingStyles="climbingStyles"
        :on-edit="handleAdd"
        label="Submit"
        label2="Add Location"
      />
    </div>
  </div>
</template>

<script>
import Location from './Location.vue';
import LocationForm from './LocationForm.vue';
import { getClimbingStyles } from '../services/api';
import { 
  getClimbingLocations,
  addLocation, 
  deleteLocation,
  updateLocation } from '../services/api.js';
export default {
  data() {
    return {
      climbingStyles: [],
      locations: null
    };
  },
  created() {
    getClimbingStyles().then(climbingStyles => {
      this.climbingStyles = climbingStyles;
    }),
    getClimbingLocations()
      .then(locations => {
        this.locations = locations;
      });
  },
  components: {
    Location,
    LocationForm
  },
  methods: {
    handleAdd(location) {
      return addLocation(location)
        .then(saved => {
          this.locations.push(saved);
        });
    },
    handleDelete(location) {
      return deleteLocation(location)
        .then(this.locations = this.locations.filter(item => item.id !== location.id));

    },
    handleUpdate(toUpdate) {
      console.log('oh hey');
      return updateLocation(toUpdate)
        .then(updated => {
          this.locations = this.locations.map(location => {
            return location.id === updated.id ? updated : location;
          });
        });
    }
  }
};
</script>

<style scoped>
  h2 {
    border: solid .5px;
  }
  .locationsList {
    float: left;
    height: 660px;
    overflow: auto;
    width: 45%;
    margin: auto;
    margin-top: -1px;
    border: solid 1px;
    background-color: rgba(201, 201, 201, 0.753);
  }
  .add-location {
    float: right;
    height: 660px;
    overflow: auto;
    width: 45%;
    margin: auto;
    margin-top: -1px;
    border: solid 1px;
    background-color: rgba(201, 201, 201, 0.753);  }
 
</style>
